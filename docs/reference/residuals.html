<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>One-step and multi-step residuals — res2matrix • FoReco</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="One-step and multi-step residuals — res2matrix"><meta name="description" content="These functions can be used to arrange residuals to reconcile temporal or
cross-temporal forecasts.
res2matrix
takes as input a set of temporal and cross-temporal residuals and
re-organizes them into a matrix where the rows correspond to different forecast
horizons, capturing the temporal dimension. Meanwhile, the columns are ordered
based on the specific arrangement as described in Di Fonzo and Girolimetto (2023).
Please see as_hstack_ctlayout and as_hstack_telayout.
arrange_hres takes as input a list of multi-step residuals and is
designed to organize them in accordance with their time order (Girolimetto et al.
2023). When applied, this function ensures that the sequence of multi-step
residuals aligns with the chronological order in which they occurred."><meta property="og:description" content="These functions can be used to arrange residuals to reconcile temporal or
cross-temporal forecasts.
res2matrix
takes as input a set of temporal and cross-temporal residuals and
re-organizes them into a matrix where the rows correspond to different forecast
horizons, capturing the temporal dimension. Meanwhile, the columns are ordered
based on the specific arrangement as described in Di Fonzo and Girolimetto (2023).
Please see as_hstack_ctlayout and as_hstack_telayout.
arrange_hres takes as input a list of multi-step residuals and is
designed to organize them in accordance with their time order (Girolimetto et al.
2023). When applied, this function ensures that the sequence of multi-step
residuals aligns with the chronological order in which they occurred."><meta property="og:image" content="https://danigiro.github.io/FoReco/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FoReco</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.0.9013</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-book"></span> Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-question-circle"></span> Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/Dataset-vndata-and-itagdp.html">The `vndata` and `itagdp` dataset</a></li>
    <li><a class="dropdown-item" href="../articles/Cross-sectional-forecast-reconciliation.html">Cross-sectional forecast reconciliation</a></li>
    <li><a class="dropdown-item" href="../articles/Temporal-forecast-reconciliation.html">Temporal forecast reconciliation</a></li>
    <li><a class="dropdown-item" href="../articles/Cross-temporal-forecast-reconciliation.html">Cross-temporal forecast reconciliation</a></li>
    <li><a class="dropdown-item" href="../articles/Replicate-the-hts-package.html">Replicate the `hts` package</a></li>
    <li><a class="dropdown-item" href="../articles/Replicate-the-thief-package.html">Replicate the `thief` package</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa far fa-newspaper"></span> News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/danigiro/FoReco" aria-label="View on GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://cran.r-project.org/web/packages/FoReco/index.html" aria-label="View on CRAN"><span class="fa fab fa-r-project fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>One-step and multi-step residuals</h1>
      <small class="dont-index">Source: <a href="https://github.com/danigiro/FoReco/blob/HEAD/R/fun_residuals.R" class="external-link"><code>R/fun_residuals.R</code></a></small>
      <div class="d-none name"><code>residuals.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions can be used to arrange residuals to reconcile temporal or
cross-temporal forecasts.</p>
<p>res2matrix <a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a>
takes as input a set of temporal and cross-temporal residuals and
re-organizes them into a matrix where the rows correspond to different forecast
horizons, capturing the temporal dimension. Meanwhile, the columns are ordered
based on the specific arrangement as described in Di Fonzo and Girolimetto (2023).
Please see <a href="ctmatrix_layouts.html">as_hstack_ctlayout</a> and <a href="tematrix_layouts.html">as_hstack_telayout</a>.</p>
<p>arrange_hres takes as input a list of multi-step residuals and is
designed to organize them in accordance with their time order (Girolimetto et al.
2023). When applied, this function ensures that the sequence of multi-step
residuals aligns with the chronological order in which they occurred.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">res2matrix</span><span class="op">(</span><span class="va">res</span>, <span class="va">agg_order</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">arrange_hres</span><span class="op">(</span><span class="va">list_res</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-res">res<a class="anchor" aria-label="anchor" href="#arg-res"></a></dt>
<dd><p>A (\(n \times N(k^\ast+m)\)) numeric matrix (cross-temporal framework)
or an (\(N(k^\ast+m) \times 1\)) numeric vector (temporal framework) representing
the in-sample residuals at all the temporal frequencies ordered from the lowest
frequency to the highest frequency (columns) for each variable (rows).</p></dd>


<dt id="arg-agg-order">agg_order<a class="anchor" aria-label="anchor" href="#arg-agg-order"></a></dt>
<dd><p>Highest available sampling frequency per seasonal cycle
(max. order of temporal aggregation, \(m\)), or a vector representing a
subset of \(p\) factors of \(m\).</p></dd>


<dt id="arg-list-res">list_res<a class="anchor" aria-label="anchor" href="#arg-list-res"></a></dt>
<dd><p>A list of \(H\) multi-step residuals. Each element in the list
can be either a (\(T \times 1\)) vector (temporal framework) or a (\(T \times n\))
matrix (cross-temporal framework).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>res2matrix returns a (\(N \times n(k^\ast + m)\)) matrix, where \(n = 1\)
for the temporal framework.</p>
<p>arrange_hres returns a (\(N(k^\ast+m) \times 1\)) vector (temporal framework)
or a (\(n \times N(k^\ast+m)\)) matrix  (cross-temporal framework) of multi-step residuals.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Let \(Z_t\), \(t=1,\dots,T\), be a univariate time series. We can define the multi-step
residuals such us
$$\widehat{\varepsilon}_{h,t} = Z_{t+h} - \widehat{Z}_{t+h|t} \qquad h \le t \le T-h$$
where \(\widehat{Z}_{t+h|t}\) is the \(h\)-step fitted value, calculated as the \(h\)-step ahead
forecast condition to the information up to time \(t\). Given the list of errors at different steps
$$\left([\widehat{\varepsilon}_{1,1}, \; \dots, \; \widehat{\varepsilon}_{1,T}], \dots, [\widehat{\varepsilon}_{H,1}, \; \dots, \; \widehat{\varepsilon}_{H,T}]\right),$$
arrange_hres returns a \(T\)-vector with the residuals, organized in the following way:
$$[\varepsilon_{1,1} \; \varepsilon_{2,2} \; \dots \; \varepsilon_{H,H} \; \varepsilon_{1,H+1} \; \dots \; \varepsilon_{H,T-H}]'$$
A similar organisation can be apply to a multivariate time series.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Di Fonzo, T. and Girolimetto, D. (2023), Cross-temporal forecast reconciliation:
Optimal combination method and heuristic alternatives, <em>International Journal
of Forecasting</em>, 39, 1, 39-57. <a href="https://doi.org/10.1016/j.ijforecast.2021.08.004" class="external-link">doi:10.1016/j.ijforecast.2021.08.004</a></p>
<p>Girolimetto, D., Athanasopoulos, G., Di Fonzo, T. and Hyndman, R.J. (2024),
Cross-temporal probabilistic forecast reconciliation: Methodological and
practical issues. <em>International Journal of Forecasting</em>, 40, 3, 1134-1151.
<a href="https://doi.org/10.1016/j.ijforecast.2023.10.003" class="external-link">doi:10.1016/j.ijforecast.2023.10.003</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Utilities:
<code><a href="FoReco2matrix.html">FoReco2matrix</a>()</code>,
<code><a href="aggts.html">aggts</a>()</code>,
<code><a href="ctmatrix_layouts.html">as_ctmatrix</a>()</code>,
<code><a href="tematrix_layouts.html">as_tevector</a>()</code>,
<code><a href="balance_hierarchy.html">balance_hierarchy</a>()</code>,
<code><a href="commat.html">commat</a>()</code>,
<code><a href="csprojmat.html">csprojmat</a>()</code>,
<code><a href="cstools.html">cstools</a>()</code>,
<code><a href="ctprojmat.html">ctprojmat</a>()</code>,
<code><a href="cttools.html">cttools</a>()</code>,
<code><a href="df2aggmat.html">df2aggmat</a>()</code>,
<code><a href="lcmat.html">lcmat</a>()</code>,
<code><a href="recoinfo.html">recoinfo</a>()</code>,
<code><a href="set_bounds.html">set_bounds</a>()</code>,
<code><a href="shrink_estim.html">shrink_estim</a>()</code>,
<code><a href="shrink_oasd.html">shrink_oasd</a>()</code>,
<code><a href="teprojmat.html">teprojmat</a>()</code>,
<code><a href="tetools.html">tetools</a>()</code>,
<code><a href="unbalance_hierarchy.html">unbalance_hierarchy</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">agg_order</span> <span class="op">&lt;-</span> <span class="fl">4</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="tetools.html">tetools</a></span><span class="op">(</span><span class="va">agg_order</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">kt</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">dim</span><span class="op">[</span><span class="st">"kt"</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate vector (temporal case)</span></span></span>
<span class="r-in"><span><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">kt</span><span class="op">*</span><span class="va">h</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">res2matrix</span><span class="op">(</span><span class="va">vec</span>, <span class="va">agg_order</span><span class="op">)</span> <span class="co"># matrix h x kt</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`res2matrix()` was deprecated in FoReco 1.0.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Please use `FoReco::as_hstack_telayout()` or `FoReco::as_hstack_ctlayout()`.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate (n x kt) matrix (cross-temporal case) with n = 3</span></span></span>
<span class="r-in"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">kt</span><span class="op">*</span><span class="va">h</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">kt</span><span class="op">*</span><span class="va">h</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">kt</span><span class="op">*</span><span class="va">h</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">res2matrix</span><span class="op">(</span><span class="va">mat</span>, <span class="va">agg_order</span><span class="op">)</span> <span class="co"># matrix h x (3*kt)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Input: 4 (forecast horizons) vectors with 4*10 elements</span></span></span>
<span class="r-in"><span><span class="va">input</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Output: 1 vector with 4*10 elements</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">arrange_hres</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Matrix version</span></span></span>
<span class="r-in"><span><span class="va">input</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">arrange_hres</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniele Girolimetto, Tommaso Di Fonzo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

