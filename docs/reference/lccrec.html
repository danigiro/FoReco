<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Level conditional coherent forecast reconciliation for genuine hierarchical/grouped time series — lccrec • FoReco</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Level conditional coherent forecast reconciliation for genuine hierarchical/grouped time series — lccrec"><meta property="og:description" content="

Forecast reconciliation procedure built on and extending the original
proposal by Hollyman et al. (2021). Level conditional coherent
reconciled forecasts may be computed in cross-sectional, temporal, and
cross-temporal frameworks. The reconciled forecasts are conditional to (i.e.,
constrained by) the base forecasts of a specific upper level of the hierarchy
(exogenous constraints). The linear constraints linking the variables may be
dealt with endogenously as well (Di Fonzo and Girolimetto, 2022).
Combined Conditional Coherent (CCC)
forecasts may be calculated as simple averages of LCC and bottom-up
reconciled forecasts, with either endogenous or exogenous constraints."><meta property="og:image" content="https://danigiro.github.io/FoReco/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FoReco</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.2.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-book"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/FoReco_package.html">Using the FoReco package</a>
    </li>
    <li>
      <a href="../articles/accuracy_indices.html">Average relative accuracy indices</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">
    <span class="far fa-newspaper"></span>
     
    News
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/daniGiro/FoReco" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://cran.r-project.org/web/packages/FoReco/index.html" class="external-link">
    <span class="fab fa-r-project fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Level conditional coherent forecast reconciliation for genuine hierarchical/grouped time series</h1>
    <small class="dont-index">Source: <a href="https://github.com/daniGiro/FoReco/blob/HEAD/R/lccrec.R" class="external-link"><code>R/lccrec.R</code></a></small>
    <div class="hidden name"><code>lccrec.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script>

Forecast reconciliation procedure built on and extending the original
proposal by Hollyman et al. (2021). Level conditional coherent
reconciled forecasts may be computed in cross-sectional, temporal, and
cross-temporal frameworks. The reconciled forecasts are conditional to (i.e.,
constrained by) the base forecasts of a specific upper level of the hierarchy
(exogenous constraints). The linear constraints linking the variables may be
dealt with endogenously as well (Di Fonzo and Girolimetto, 2022).
<em>Combined Conditional Coherent</em> (CCC)
forecasts may be calculated as simple averages of LCC and bottom-up
reconciled forecasts, with either endogenous or exogenous constraints.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lccrec</span><span class="op">(</span><span class="va">basef</span>, <span class="va">m</span>, <span class="va">C</span>, <span class="va">nl</span>, <span class="va">weights</span>, bnaive <span class="op">=</span> <span class="cn">NULL</span>, const <span class="op">=</span> <span class="st">"exogenous"</span>,</span>
<span>       CCC <span class="op">=</span> <span class="cn">TRUE</span>, nn <span class="op">=</span> <span class="cn">FALSE</span>, nn_type <span class="op">=</span> <span class="st">"osqp"</span>, settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>basef</dt>
<dd><p>matrix/vector of base forecasts to be reconciled:
(<em></em>\(h \times n\)) matrix in the cross-sectional framework;
(<em></em>\(h(k^\ast + m) \times 1\)) vector in the temporal framework;
(<em></em>\(n \times h(k^\ast+m)\)) matrix in the cross-temporal framework.
<em></em>\(n\) is the total number of variables, <em></em>\(m\) is the highest time
frequency, <em></em>\(k^\ast\) is the sum of (a subset of) (<em></em>\(p-1\)) factors
of <em></em>\(m\), excluding <em></em>\(m\), and <em></em>\(h\) is the forecast horizon.</p></dd>


<dt>m</dt>
<dd><p>Highest available sampling frequency per seasonal cycle (max. order
of temporal aggregation, <em></em>\(m\)), or a subset of the <em></em>\(p\) factors
of <em></em>\(m\).</p></dd>


<dt>C</dt>
<dd><p>(<em></em>\(n_a \times n_b\)) cross-sectional (contemporaneous) matrix
mapping the bottom level series into the higher level ones (or a list
of matrices forming <em></em>\(\mathbf{C} = [\mathbf{C}_1' \; \mathbf{C}_2' \; ... \; \mathbf{C}_L']'\),
<em></em>\(1, ..., L\) being the number of the cross-sectional upper levels.</p></dd>


<dt>nl</dt>
<dd><p>(<em></em>\(L \times 1\)) vector containing the number of time series
in each level of the hierarchy (<code>nl[1] = 1</code>).</p></dd>


<dt>weights</dt>
<dd><p>covariance matrix or a vector (weights used in the reconciliation:
either (<em></em>\(n_b \times 1\)) for exogenous or (<em></em>\(n \times 1\)) for
endogenous constraints).</p></dd>


<dt>bnaive</dt>
<dd><p>matrix/vector of naive bts base forecasts
(e.g., seasonal averages, as in Hollyman et al., 2021):
(<em></em>\(h \times n_b\)) matrix in the cross-sectional framework;
(<em></em>\(h m \times 1\)) vector in the temporal framework;
(<em></em>\(n_b \times h m\)) matrix in the cross-temporal framework.
Ignore it, if only basef are to be used as base forecasts.</p></dd>


<dt>const</dt>
<dd><p><strong>exo</strong>genous (<em>default</em>) or <strong>endo</strong>genous
constraints</p></dd>


<dt>CCC</dt>
<dd><p>Option to return Combined Conditional Coherent reconciled
forecasts (<em>default</em> is TRUE).</p></dd>


<dt>nn</dt>
<dd><p>Logical value: <code>TRUE</code> if non-negative reconciled forecasts
are wished.</p></dd>


<dt>nn_type</dt>
<dd><p>Non-negative method: "osqp" (<em>default</em>) or "sntz"
(<em>set-negative-to-zero</em>, only if <code>CCC = TRUE</code>) with exogenous
constraints (<code>const = "exo"</code>); "osqp" (<em>default</em>), "KAnn"
(only <code>type == "M"</code>) or "sntz" with endogenous constraints
(<code>const = "endo"</code>).</p></dd>


<dt>settings</dt>
<dd><p>Settings for <span class="pkg">osqp</span> (object <code><a href="https://rdrr.io/pkg/osqp/man/osqpSettings.html" class="external-link">osqpSettings</a></code>).
The default options are: <code>verbose = FALSE</code>, <code>eps_abs = 1e-5</code>,
<code>eps_rel = 1e-5</code>, <code>polish_refine_iter = 100</code> and <code>polish = TRUE</code>.
For details, see the <a href="https://osqp.org/" class="external-link"><span class="pkg">osqp</span> documentation</a>
(Stellato et al., 2019).</p></dd>


<dt>...</dt>
<dd><p>Additional functional arguments passed to <a href="htsrec.html">htsrec</a> of
FoReco.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The function returns the level reconciled forecasts
in case of an elementary hierarchy with one level.
Otherwise it returns a list with</p>
<dl><dt><code>recf</code></dt>
<dd><p>Level Conditional Coherent (<code>CCC = FALSE</code>) forecasts
matrix/vector calculated as simple averages of upper level conditional
reconciled forecasts, with either endogenous or exogenous constraints.
If <code>CCC = TRUE</code> then it is the Combined Conditional Coherent matrix/vector,
as weighted averages of LCC and bottom-up reconciled forecasts.</p></dd>

<dt><code>levrecf</code></dt>
<dd><p>list of level conditional reconciled forecasts (+ BU).</p></dd>

<dt><code>info</code> (<code>type="osqp"</code>)</dt>
<dd><p>matrix with some useful indicators (columns)
for each forecast horizon <em></em>\(h\) (rows): run time (<code>run_time</code>), number of iteration,
norm of primal residual (<code>pri_res</code>), status of osqp's solution (<code>status</code>) and
polish's status (<code>status_polish</code>).</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><strong>Cross-sectional hierarchies</strong></p>
<p>To be as simple as possible, we fix the forecast horizon equal to 1.
Let the base forecasts be a vector <em></em>\(\widehat{\mathbf{y}} =
\left[\widehat{\mathbf{a}}' \; \widehat{\mathbf{b}}'\right]'\), where
vector <em></em>\(\widehat{\mathbf{a}}\) consists of the sub-vectors forming each
of the upper <em></em>\(L\) levels of the hierarchy/grouping:
\[\widehat{\mathbf{a}} = \left[\begin{array}{c}
    \widehat{a}_1 \cr \widehat{\mathbf{a}}_2 \cr \vdots \cr \widehat{\mathbf{a}}_L
    \end{array}\right],\]
where <em></em>\(\widehat{\mathbf{a}}_l\), <em></em>\(l=1,\ldots, L\), has dimension
<em></em>\((n_l \times 1)\) and <em></em>\(\sum_{l=1}^{L} n_l = n_a\). Denote
<em></em>\(\mathbf{C}_l\) the <em></em>\((n_l \times n_b)\) matrix mapping the
bts into the level-<em></em>\(l\) uts, then the aggregation matrix
<em></em>\(\mathbf{C}\) may be written as
\[\mathbf{C} = \left[\begin{array}{c}
  \mathbf{C}_1 \cr\mathbf{C}_2 \cr \vdots \cr \mathbf{C}_L
  \end{array}\right],\]
where the generic matrix <em></em>\(\mathbf{C}_L\) is (<em></em>\(n_L \times n_b\)),
<em></em>\(l=1, \ldots, L\). Given a generic level <em></em>\(l\), the reconciled
forecasts coherent with the base forecasts of that level are the solution to
a quadratic minimization problem with linear
exogenous constraints (<code>const = "exo"</code>):
\[\begin{array}{c}\widetilde{\mathbf{b}}_{l} = \arg\min_{\mathbf{b}}
\left(\mathbf{b} - \widehat{\mathbf{b}}\right)'\mathbf{W}_b^{-1}
\left(\mathbf{b} - \widehat{\mathbf{b}}\right) \quad \mbox{ s.t. }
\mathbf{C}_l\mathbf{b} = \widehat{\mathbf{a}}_l, \quad l=1, \ldots, L ,\cr
\Downarrow \cr
\widetilde{\mathbf{b}}_{l} = \widehat{\mathbf{b}} +
\mathbf{W}_b\mathbf{C}_l'\left(\mathbf{C}_l\mathbf{W}_b\mathbf{C}_l'
\right)^{-1}\left(\widehat{\mathbf{a}}_l -\mathbf{C}_l\widehat{\mathbf{b}}
\right), \quad l=1,\ldots,L,\end{array}\]
where <em></em>\(\mathbf{W}_b\) is a (<em></em>\(n_b \times n_b\)) p.d. matrix
(in Hollyman et al., 2021, <em></em>\(\mathbf{W}_b\) is diagonal).
If endogenous constraints (<code>const = "endo"</code>) are considered,
denote <em></em>\(\widehat{\mathbf{y}}_l =
\left[\widehat{\mathbf{a}}_l' \; \widehat{\mathbf{b}}'\right]'\) and
<em></em>\(\mathbf{U}_l' = \left[\mathbf{I}_{n_l}'  \; \mathbf{C}_l'\right]'\),
then
\[\begin{array}{c}\widetilde{\mathbf{y}}_{l} = \arg\min_{\mathbf{y}_l}
\left(\mathbf{y}_l - \widehat{\mathbf{y}}_l\right)'\mathbf{W}_l^{-1}
\left(\mathbf{y}_l - \widehat{\mathbf{y}}_l\right) \quad \mbox{ s.t. }
\mathbf{U}_l'\mathbf{y}_l = \mathbf{0}, \quad l=1, \ldots, L ,\cr
\Downarrow \cr
\widetilde{\mathbf{y}}_{l} = \left(\mathbf{I}_{n_b+n_l} -
\mathbf{W}_l\mathbf{U}_l\left(\mathbf{U}_l'\mathbf{W}_l
\mathbf{U}_l\right)^{-1}\mathbf{U}_l'\right)\widehat{\mathbf{y}}_{l},
\quad l=1,...,L,
\end{array}\]
where <em></em>\(\mathbf{W}_l\) is a (<em></em>\(n_l + n_b \times n_l + n_b\))
p.d. matrix.
Combined Conditional Coherent (CCC) forecasts are obtained by taking
the simple average of the <em></em>\(L\) level conditional, and of the bottom-up
reconciled forecasts, respectively (Di Fonzo and Girolimetto, 2022):
\[\widetilde{\mathbf{y}}_{CCC}=\frac{1}{L+1}\sum_{l=1}^{L+1} \mathbf{S}\widetilde{\mathbf{b}}_l,\]
with \[\widetilde{\mathbf{b}}_{L+1} = \widehat{\mathbf{b}}.\]</p>
<p>Non-negative reconciled forecasts may be obtained by setting <code>nn_type</code>
alternatively as:</p><ul><li><p>to apply non-negative constraints to each level:</p><ul><li><p><code>nn_type = "KAnn"</code> (only <code>const = "endo"</code>)</p></li>
<li><p><code>nn_type = "osqp"</code></p></li>
</ul></li>
<li><p>to apply non-negative constraints only to the CCC forecasts:</p><ul><li><p><code>nn_type = "sntz"</code> ("set-negative-to-zero")</p></li>
</ul></li>
</ul><p><strong>Temporal hierarchies</strong></p>
<p>The extension to the case of <strong>temporal hierarchies</strong> is quite simple.
Using the same notation as in <code><a href="thfrec.html">thfrec</a>()</code>, the
following `equivalences' hold between the symbols used
for the level conditional cross-sectional reconciliation and the ones
used in temporal reconciliation:
\[L \equiv p-1, \quad (n_a, n_b, n) \equiv (k^*, m, k^*+m),\]
and
\[\mathbf{C} \equiv \mathbf{K} , \;
\mathbf{C}_1 \equiv \mathbf{K}_1 = \mathbf{1}_m', \;
\mathbf{C}_2 \equiv \mathbf{K}_2 = \mathbf{I}_{\frac{m}{k_{p-1}}},\; \ldots, \;
\mathbf{C}_L \equiv \mathbf{K}_{p-1} = \mathbf{I}_{\frac{m}{k_{2}}} \otimes
\mathbf{1}_{k_{2}}',\; \mathbf{S} \equiv \mathbf{R}.\]</p>
<p>The description of the <strong>cross-temporal extension</strong> is currently under progress.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Di Fonzo, T., and Girolimetto, D. (2021), Cross-temporal forecast reconciliation:
Optimal combination method and heuristic alternatives, <em>International Journal
of Forecasting</em>, in press.</p>
<p>Di Fonzo, T., Girolimetto, D. (2022), Forecast combination based forecast reconciliation:
insights and extensions, <em>International Journal of Forecasting</em>, in press.</p>
<p>Hollyman, R., Petropoulos, F., Tipping, M.E. (2021), Understanding Forecast Reconciliation,
<em>European Journal of Operational Research</em> (in press).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other reconciliation procedures: 
<code><a href="cstrec.html">cstrec</a>()</code>,
<code><a href="ctbu.html">ctbu</a>()</code>,
<code><a href="htsrec.html">htsrec</a>()</code>,
<code><a href="iterec.html">iterec</a>()</code>,
<code><a href="octrec.html">octrec</a>()</code>,
<code><a href="tcsrec.html">tcsrec</a>()</code>,
<code><a href="tdrec.html">tdrec</a>()</code>,
<code><a href="thfrec.html">thfrec</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">### LCC and CCC CROSS-SECTIONAL FORECAST RECONCILIATION</span></span></span>
<span class="r-in"><span><span class="co"># Cross sectional aggregation matrix</span></span></span>
<span class="r-in"><span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">$</span><span class="va">C</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># monthly base forecasts</span></span></span>
<span class="r-in"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">simplify2array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">$</span><span class="va">base</span><span class="op">)</span>, split <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">==</span> <span class="st">"k1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mbase</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">$</span><span class="va">base</span><span class="op">[</span>, <span class="va">id</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"AA"</span>,<span class="st">"AB"</span>,<span class="st">"BA"</span>,<span class="st">"BB"</span>,<span class="st">"C"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># residuals</span></span></span>
<span class="r-in"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">simplify2array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">$</span><span class="va">res</span><span class="op">)</span>, split <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">==</span> <span class="st">"k1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">$</span><span class="va">res</span><span class="op">[</span>, <span class="va">id</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"AA"</span>,<span class="st">"AB"</span>,<span class="st">"BA"</span>,<span class="st">"BB"</span>,<span class="st">"C"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># covariance matrix of all the base forecasts, computed using the in-sample residuals</span></span></span>
<span class="r-in"><span><span class="va">Wres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">mres</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># covariance matrix of the bts base forecasts, computed using the in-sample residuals</span></span></span>
<span class="r-in"><span><span class="va">Wb</span> <span class="op">&lt;-</span> <span class="va">Wres</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AA"</span>,<span class="st">"AB"</span>, <span class="st">"BA"</span>, <span class="st">"BB"</span>, <span class="st">"C"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AA"</span>,<span class="st">"AB"</span>, <span class="st">"BA"</span>, <span class="st">"BB"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># bts seasonal averages</span></span></span>
<span class="r-in"><span><span class="va">obs_1</span> <span class="op">&lt;-</span> <span class="va">FoReco_data</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">k1</span></span></span>
<span class="r-in"><span><span class="va">bts_sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">obs_1</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">168</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">14</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bts_sm</span> <span class="op">&lt;-</span> <span class="va">bts_sm</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AA"</span>, <span class="st">"AB"</span>, <span class="st">"BA"</span>, <span class="st">"BB"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## EXOGENOUS CONSTRAINTS AND DIAGONAL COVARIANCE MATRIX (Hollyman et al., 2021)</span></span></span>
<span class="r-in"><span><span class="co"># Forecast reconciliation for an elementary hierarchy:</span></span></span>
<span class="r-in"><span><span class="co"># 1 top-level series + 5 bottom-level series (Level 2 base forecasts are not considered).</span></span></span>
<span class="r-in"><span><span class="co"># The input is given by the base forecasts of the top and bottom levels series,</span></span></span>
<span class="r-in"><span><span class="co"># along with a vector of positive weights for the bts base forecasts</span></span></span>
<span class="r-in"><span><span class="va">exo_EHd</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>,<span class="st">"AA"</span>,<span class="st">"AB"</span>, <span class="st">"BA"</span>, <span class="st">"BB"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                 weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Wb</span><span class="op">)</span>, bnaive <span class="op">=</span> <span class="va">bts_sm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Level conditional reconciled forecasts</span></span></span>
<span class="r-in"><span><span class="co"># recf/L1: Level 1 reconciled forecasts for the whole hierarchy</span></span></span>
<span class="r-in"><span><span class="co"># L2: Middle-Out reconciled forecasts hinging on Level 2 conditional reconciled forecasts</span></span></span>
<span class="r-in"><span><span class="co"># L3: Bottom-Up reconciled forecasts</span></span></span>
<span class="r-in"><span><span class="va">exo_LCd</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span>, C <span class="op">=</span> <span class="va">C</span>, nl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Wb</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 CCC <span class="op">=</span> <span class="cn">FALSE</span>, bnaive <span class="op">=</span> <span class="va">bts_sm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combined Conditional Coherent (CCC) reconciled forecasts</span></span></span>
<span class="r-in"><span><span class="co"># recf: CCC reconciled forecasts matrix</span></span></span>
<span class="r-in"><span><span class="co"># L1: Level 1 conditional reconciled forecasts for the whole hierarchy</span></span></span>
<span class="r-in"><span><span class="co"># L2: Middle-Out reconciled forecasts hinging on Level 2 conditional reconciled forecasts</span></span></span>
<span class="r-in"><span><span class="co"># L3: Bottom-Up reconciled forecasts</span></span></span>
<span class="r-in"><span><span class="va">exo_CCCd</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span>, C <span class="op">=</span> <span class="va">C</span>, nl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Wb</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## EXOGENOUS CONSTRAINTS AND FULL COVARIANCE MATRIX</span></span></span>
<span class="r-in"><span><span class="co"># Simply substitute weights=diag(Wb) with weights=Wb</span></span></span>
<span class="r-in"><span><span class="va">exo_EHf</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>,<span class="st">"AA"</span>,<span class="st">"AB"</span>, <span class="st">"BA"</span>, <span class="st">"BB"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">]</span>, weights <span class="op">=</span> <span class="va">Wb</span>, bnaive <span class="op">=</span> <span class="va">bts_sm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">exo_LCf</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span>, C <span class="op">=</span> <span class="va">C</span>, nl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, weights <span class="op">=</span> <span class="va">Wb</span>, CCC <span class="op">=</span> <span class="cn">FALSE</span>, bnaive <span class="op">=</span> <span class="va">bts_sm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">exo_CCCf</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span>, C <span class="op">=</span> <span class="va">C</span>, nl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, weights <span class="op">=</span> <span class="va">Wb</span>, bnaive <span class="op">=</span> <span class="va">bts_sm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ENDOGENOUS CONSTRAINTS AND DIAGONAL COVARIANCE MATRIX</span></span></span>
<span class="r-in"><span><span class="co"># parameters of function htsrec(), like "type" and "nn_type" may be used</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Forecast reconciliation for an elementary hierarchy with endogenous constraints</span></span></span>
<span class="r-in"><span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="va">Wres</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>,<span class="st">"AA"</span>,<span class="st">"AB"</span>, <span class="st">"BA"</span>, <span class="st">"BB"</span>, <span class="st">"C"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>,<span class="st">"AA"</span>,<span class="st">"AB"</span>, <span class="st">"BA"</span>, <span class="st">"BB"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">endo_EHd</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>,<span class="st">"AA"</span>,<span class="st">"AB"</span>, <span class="st">"BA"</span>, <span class="st">"BB"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                 weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span>, const <span class="op">=</span> <span class="st">"endo"</span>, CCC <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Level conditional reconciled forecasts with endogenous constraints</span></span></span>
<span class="r-in"><span><span class="va">endo_LCd</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span>, C <span class="op">=</span> <span class="va">C</span>, nl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Wres</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  const <span class="op">=</span> <span class="st">"endo"</span>, CCC <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combined Conditional Coherent (CCC) reconciled forecasts with endogenous constraints</span></span></span>
<span class="r-in"><span><span class="va">endo_CCCd</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span>, C <span class="op">=</span> <span class="va">C</span>, nl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Wres</span><span class="op">)</span>, const <span class="op">=</span> <span class="st">"endo"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ENDOGENOUS CONSTRAINTS AND FULL COVARIANCE MATRIX</span></span></span>
<span class="r-in"><span><span class="co"># Simply substitute weights=diag(Wres) with weights=Wres</span></span></span>
<span class="r-in"><span><span class="va">endo_EHf</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>,<span class="st">"AA"</span>,<span class="st">"AB"</span>, <span class="st">"BA"</span>, <span class="st">"BB"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                   weights <span class="op">=</span> <span class="va">W1</span>,</span></span>
<span class="r-in"><span>                   const <span class="op">=</span> <span class="st">"endo"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">endo_LCf</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span>, C <span class="op">=</span> <span class="va">C</span>, nl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   weights <span class="op">=</span> <span class="va">Wres</span>, const <span class="op">=</span> <span class="st">"endo"</span>, CCC <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">endo_CCCf</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">mbase</span><span class="op">-</span><span class="fl">40</span>, C <span class="op">=</span> <span class="va">C</span>, nl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   weights <span class="op">=</span> <span class="va">Wres</span>, const <span class="op">=</span> <span class="st">"endo"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### LCC and CCC TEMPORAL FORECAST RECONCILIATION</span></span></span>
<span class="r-in"><span><span class="co"># top ts base forecasts ([lowest_freq' ...  highest_freq']')</span></span></span>
<span class="r-in"><span><span class="va">topbase</span> <span class="op">&lt;-</span> <span class="va">FoReco_data</span><span class="op">$</span><span class="va">base</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># top ts residuals ([lowest_freq' ...  highest_freq']')</span></span></span>
<span class="r-in"><span><span class="va">topres</span> <span class="op">&lt;-</span> <span class="va">FoReco_data</span><span class="op">$</span><span class="va">res</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">Om_bt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">topres</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">simplify2array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">topres</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            <span class="st">"_"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">==</span><span class="st">"k1"</span><span class="op">)</span><span class="op">]</span>, ncol <span class="op">=</span> <span class="fl">12</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">t_exo_LCd</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">topbase</span>, m <span class="op">=</span> <span class="fl">12</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Om_bt</span><span class="op">)</span>, CCC <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">t_exo_CCCd</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">topbase</span>, m <span class="op">=</span> <span class="fl">12</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Om_bt</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### LCC and CCC CROSS-TEMPORAL FORECAST RECONCILIATION</span></span></span>
<span class="r-in"><span><span class="va">idr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">simplify2array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">$</span><span class="va">res</span><span class="op">)</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">==</span><span class="st">"k1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bres</span> <span class="op">&lt;-</span> <span class="va">FoReco_data</span><span class="op">$</span><span class="va">res</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="va">idr</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">bres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">bres</span><span class="op">[</span><span class="va">x</span>,<span class="op">]</span>, nrow<span class="op">=</span><span class="fl">14</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">bres</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ctbase</span> <span class="op">&lt;-</span> <span class="va">FoReco_data</span><span class="op">$</span><span class="va">base</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"AA"</span>,<span class="st">"AB"</span>,<span class="st">"BA"</span>,<span class="st">"BB"</span>,<span class="st">"C"</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">ct_exo_LCf</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">ctbase</span>, m <span class="op">=</span> <span class="fl">12</span>, C <span class="op">=</span> <span class="va">C</span>, nl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">bres</span><span class="op">)</span><span class="op">)</span>, CCC <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ct_exo_CCCf</span> <span class="op">&lt;-</span> <span class="fu">lccrec</span><span class="op">(</span>basef <span class="op">=</span> <span class="va">ctbase</span>, m <span class="op">=</span> <span class="fl">12</span>, C <span class="op">=</span> <span class="va">C</span>, nl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">bres</span><span class="op">)</span><span class="op">)</span>, CCC <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Daniele Girolimetto, Tommaso Di Fonzo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

